{% import "macros/header.html" as header_macros %}
{% import "macros/base.html" as base_macros %}

{# Shortcut to get the section/page. This variable will have a value except in some special pages like `404.html`. #}
{% set_global section_or_page = false %}
{% if section or page %}
{% set_global section_or_page = section | default(value=page) %}
{% endif %}

{% if section_or_page %}
{% set_global root_section_paths = ["code"] %}
{% for root_section_path in root_section_paths %}
{% set components = root_section_path | split(pat="/") %}
{% if section_or_page.components | slice(end=components | length) == components %}
{% set_global root_section = get_section(path=root_section_path ~ "/_index.md") %}
{% break %}
{% endif %}
{% endfor %}
{% endif %}

{% set current_path = current_path | default(value="/") %}

{% if section and section.title %}
{% set page_title = section.title %}
{% elif page and page.title %}
{% set page_title =page.title %}
{% else %}
{% set page_title = "" %}
{% endif %}

{% if section and section.path %}
{% set path = "/" ~ section.path %}
{% elif page and page.path %}
{% set path = "/" ~ page.path %}
{% else %}
{% set path = "" %}
{% endif %}

{% set newline = "
" %}
<!DOCTYPE html>
<html lang="en" class="{% block theme %}{% endblock theme %}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="Josiah Putman - {{ page_title }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://bevy.org{{ path }}" />
    <meta property="og:image" content="https://bevy.org/assets/bevy_logo_fill.png" />
    <meta property="og:description"
        content="Bevy is a refreshingly simple data-driven game engine built in Rust. It is free and open-source forever!" />
    <link rel="shortcut icon" type="image/png" href="/assets/favicon.png">
    <link rel="stylesheet" href="/site.css" />
    <link href="/atom.xml" rel="alternate" type="application/atom+xml" />
    <title>Josiah Putman - {{ page_title }}</title>
    {% block head_extensions %}{% endblock head_extensions %}
</head>

<body>
    <div class="layout">
        <input id="mobile-menu-state" class="hidden" type="checkbox">
        <header class="layout__header header print:hidden" data-mobile-menu-state-container>
            <div class="header__content">
                <label class="main-menu-backdrop" for="mobile-menu-state"></label>
                <label class="header__hamburger button-square button-square--header" for="mobile-menu-state">
                    <img src="/assets/icon-hamburger.svg" alt="Three horizontal lines stacked on top of eachother"
                        width="20" height="16">
                </label>
                <div class="header__left-block">
                    <div class="header__bold_message">
                        Josiah Putman
                    </div>
                    <div class="header__message">
                        {{ base_macros::page_header_message(section_or_page=section_or_page) }}
                    </div>
                </div>
                {% block mobile_page_menu_state %}{% endblock mobile_page_menu_state %}
                <nav class="header__menu main-menu {% block main_menu_extra_class %}{% endblock main_menu_extra_class %}"
                    role="navigation" data-page-menu-switch-state-container>
                    <div class="main-menu__header">
                        <a href="/">
                            <picture class="logo">
                                <img class="logo" src="/assets/bevy_logo_dark.svg" alt="Bevy Engine" width="520"
                                    height="130" />
                            </picture>
                        </a>
                        <label class="button-square button-square--header" for="mobile-menu-state">
                            <img src="/assets/icon-times.svg" alt="A saltire or x-cross" width="16" height="16">
                        </label>
                    </div>
                    {% block mobile_page_menu_switch %}{% endblock mobile_page_menu_switch %}
                    <div class="main-menu__content">
                        <div class="main-menu__page-menu">
                            {% block mobile_page_menu %}{% endblock mobile_page_menu %}
                        </div>
                        <ul class="main-menu__menu">
                            {% set pages = load_data(path="/content/pages.toml")%}
                            {% for page in pages.links %}
                            {% set class = "main-menu__link" %}
                            {% if current_path == page.url %}
                            {% set class = class~" main-menu__link--active" %}
                            {% endif %}
                            <li class="main-menu__entry">
                                <a href="{{ page.url }}" class="{{ class }}">
                                    <span>{{ page.title }}</span>
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </nav>
                <div class="header__cta-container">
                    <a class="header__cta header__cta--github"
                        href="https://github.com/Katsutoshii/katsutoshii.github.io">
                        <img src="/assets/profiles/github-mark-white.svg" alt="GitHub repo" width="98" height="96" />
                    </a>
                </div>
            </div>
        </header>
        <main class="layout__content">
            <div class="container">
                {% block content %}{% endblock content %}
            </div>
        </main>
        <footer class="print:hidden">
        </footer>
    </div>

    <footer class="print:hidden">
        {% block footer_extensions %}{% endblock footer_extensions %}
        <div class="footer__social-container">
            {% set profiles = load_data(path="content/profiles.toml") %}
            {% for link in profiles.links %}
            {% if link.show_in_footer %}
            <a class="footer__social" href="{{ link.url }}" title="{{ link.title }}">
                <img src="{{ link.image }}" alt="{{ link.image_alt }}" width="24" height="24" />
            </a>
            {% endif %}
            {% endfor %}
        </div>
    </footer>
    </div>
</body>

</html>