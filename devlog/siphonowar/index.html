

























<!DOCTYPE html>
<html lang="en" class="light-mode">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="Josiah Putman - Siphonowar" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://katsutoshii.github.io&#x2F;&#x2F;devlog&#x2F;siphonowar&#x2F;" />
    <meta property="og:description"
        content="Bevy is a refreshingly simple data-driven game engine built in Rust. It is free and open-source forever!" />
    <link rel="shortcut icon" type="image/svg" href="/assets/rust-logo-light.svg">
    <link rel="stylesheet" href="/site.css" />
    <link href="/atom.xml" rel="alternate" type="application/atom+xml" />
    <title>Josiah Putman - Siphonowar</title>
    







<script src="/optional-helpers.js"></script>
<script defer src="/highlight-intrapage-link.js"></script>

</head>

<body>
    <div class="layout">
        <input id="mobile-menu-state" class="hidden" type="checkbox">
        <header class="layout__header header print:hidden" data-mobile-menu-state-container>
            <div class="header__content">
                <label class="main-menu-backdrop" for="mobile-menu-state"></label>
                <label class="header__hamburger button-square button-square--header" for="mobile-menu-state">
                    <img src="/assets/icon-hamburger.svg" alt="Three horizontal lines stacked on top of eachother"
                        width="20" height="16">
                </label>
                <div class="header__left-block">
                    <div class="header__bold_message">
                        Josiah Putman
                    </div>
                    <div class="header__message">
                        




                    </div>
                </div>
                
<input id="page-menu-switch-state" class="hidden" type="checkbox" checked>

                <nav class="header__menu main-menu main-menu--with-page-menu"
                    role="navigation" data-page-menu-switch-state-container>
                    <div class="main-menu__header">
                        <a href="/">
                            <picture class="logo">
                                <img class="logo" src="/assets/opensource.svg" alt="Josiah Putman" width="520"
                                    height="130" />
                            </picture>
                        </a>
                        <label class="button-square button-square--header" for="mobile-menu-state">
                            <img src="/assets/icon-times.svg" alt="A saltire or x-cross" width="16" height="16">
                        </label>
                    </div>
                    
<div class="main-menu__page-menu-switch">
  <label class="menu-switch" for="page-menu-switch-state">
    <div class="menu-switch__option menu-switch__option--main-menu">Main Menu</div>
    <div class="menu-switch__option menu-switch__option--page-menu">
      






    </div>
  </label>
</div>

                    <div class="main-menu__content">
                        <div class="main-menu__page-menu">
                            

  <ul class="tree-menu">
    
    
    
    
    
      
        
          
  
  
  
  
  
  
    
  
  
  <li class="tree-menu__item tree-menu__item--active">
    <div class="tree-menu__label">
      <a class="tree-menu__link" href="&#x2F;devlog&#x2F;siphonowar&#x2F;">Siphonowar</a>
      
        
<nav aria-label="On This Page" class="on-this-page tree-menu__toc" data-highlight-intrapage-link>
  
  <ul>
  
    <li>
      <a href="#spatial-grid-in-bevy">Spatial grid in Bevy</a>
      
    </li>
  
    <li>
      <a href="#fog-of-war">Fog of war</a>
      
        <ul>
          
          <li>
            <a href="#smoothing">Smoothing</a>
          </li>
          
        </ul>
      
    </li>
  
  </ul>
</nav>

      
    </div>
  </li>

        
      
        
          
  
  
  
  
  
  
  
  <li class="tree-menu__item">
    <div class="tree-menu__label">
      <a class="tree-menu__link" href="&#x2F;devlog&#x2F;zola&#x2F;">Zola</a>
      
    </div>
  </li>

        
      
    
  </ul>


                        </div>
                        <ul class="main-menu__menu">
                            
                            
                            
                            
                            <li class="main-menu__entry">
                                <a href="&#x2F;" class="main-menu__link">
                                    <span>About</span>
                                </a>
                            </li>
                            
                            
                            
                            <li class="main-menu__entry">
                                <a href="&#x2F;projects&#x2F;" class="main-menu__link">
                                    <span>Projects</span>
                                </a>
                            </li>
                            
                            
                            
                            <li class="main-menu__entry">
                                <a href="&#x2F;resume&#x2F;" class="main-menu__link">
                                    <span>Resume</span>
                                </a>
                            </li>
                            
                            
                            
                            <li class="main-menu__entry">
                                <a href="&#x2F;cv&#x2F;" class="main-menu__link">
                                    <span>CV</span>
                                </a>
                            </li>
                            
                            
                            
                            <li class="main-menu__entry">
                                <a href="&#x2F;devlog&#x2F;" class="main-menu__link">
                                    <span>Devlog</span>
                                </a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
                <div class="header__cta-container">
                    <a class="header__cta header__cta--github"
                        href="https://github.com/Katsutoshii/katsutoshii.github.io">
                        <img src="/assets/profiles/github-mark-white.svg" alt="GitHub repo" width="98" height="96" />
                    </a>
                </div>
            </div>
        </header>
        <main class="layout__content">
            <div class="container">
                
<div class="page-with-menu ">
  <div class="page-with-menu__menu-wrapper print:hidden">
    <div class="page-with-menu__menu">
      

  <ul class="tree-menu">
    
    
    
    
    
      
        
          
  
  
  
  
  
  
    
  
  
  <li class="tree-menu__item tree-menu__item--active">
    <div class="tree-menu__label">
      <a class="tree-menu__link" href="&#x2F;devlog&#x2F;siphonowar&#x2F;">Siphonowar</a>
      
        
<nav aria-label="On This Page" class="on-this-page tree-menu__toc" data-highlight-intrapage-link>
  
  <ul>
  
    <li>
      <a href="#spatial-grid-in-bevy">Spatial grid in Bevy</a>
      
    </li>
  
    <li>
      <a href="#fog-of-war">Fog of war</a>
      
        <ul>
          
          <li>
            <a href="#smoothing">Smoothing</a>
          </li>
          
        </ul>
      
    </li>
  
  </ul>
</nav>

      
    </div>
  </li>

        
      
        
          
  
  
  
  
  
  
  
  <li class="tree-menu__item">
    <div class="tree-menu__label">
      <a class="tree-menu__link" href="&#x2F;devlog&#x2F;zola&#x2F;">Zola</a>
      
    </div>
  </li>

        
      
    
  </ul>


    </div>
  </div>
  <div class="page-with-menu__content">
    
<div class="docs-page">
    <div class="docs-content">

        
        
        
        
        
        
        
        
        
        
        
        
        <h1>
            Siphonowar
        </h1>
        <div class="media-content">
            <p>Here I document my work on Siphonowar, an RTS based in the bottom of the ocean floor where the player controls a complex organism called a Siphonophore.
I started this project to learn the <a href="https://bevy.org">Bevy Game Engine</a>.</p>
<h2 id="spatial-grid-in-bevy">Spatial grid in Bevy<a class="zola-anchor" href="#spatial-grid-in-bevy" aria-label="Anchor link for: spatial-grid-in-bevy">ðŸ”—</a></h2>
<p>Most games require checking for neighboring entities and RTS games are no exception.
A naive approach to identify neighboring entities is to check all pairs of entities.
This is quadratic in time complexity, which is unacceptable for a game where the goal is several thousand simualted entities.
There are many common solutions to this problem, such as <a href="https://en.wikipedia.org/wiki/K-d_tree">k-d trees</a>.
I ended up going with a simpler approach of partitioning the space into a grid of fixed size.</p>
<p>Every grid in the game is specified by the following struct:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">GridSpec</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">rows</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">u32</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">cols</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">u32</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">width</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">f32</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>Given an xy position of an entity (where x, y are positive), we can compute its grid cell by:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GridSpec</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">discretize</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">value</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">f32</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">if</span> value <span class="z-keyword z-operator z-comparison z-rust">&lt;</span> <span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">0</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">return</span> <span class="z-support z-type z-rust">None</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>value <span class="z-keyword z-operator z-arithmetic z-rust">/</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>width</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">as</span> <span class="z-storage z-type z-rust">u32</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">to_rowcol</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">position</span><span class="z-punctuation z-separator z-rust">:</span> Vec2</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>RowCol<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        position <span class="z-keyword z-operator z-assignment z-rust">+=</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">offset</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> res <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">discretize</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>position<span class="z-punctuation z-accessor z-dot z-rust">.</span>y</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">discretize</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>position<span class="z-punctuation z-accessor z-dot z-rust">.</span>x</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">if</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">in_bounds</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>res</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">return</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>res</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">None</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>All neighboring cells can be computed by:</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GridSpec</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">get_in_radius_discrete</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">rowcol</span><span class="z-punctuation z-separator z-rust">:</span> RowCol, <span class="z-variable z-parameter z-rust">radius</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Vec</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>RowCol<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>row<span class="z-punctuation z-separator z-rust">,</span> col</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> rowcol<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">if</span> <span class="z-keyword z-operator z-logical z-rust">!</span><span class="z-storage z-type z-rust">Self</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>in_bounds<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-separator z-rust">,</span> rowcol</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">return</span> <span class="z-support z-macro z-rust">vec!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> results <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-type z-rust">Vec</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>default<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">for</span> other_row <span class="z-keyword z-operator z-rust">in</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">cell_range</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>row<span class="z-punctuation z-separator z-rust">,</span> radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">for</span> other_col <span class="z-keyword z-operator z-rust">in</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">cell_range</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>col<span class="z-punctuation z-separator z-rust">,</span> radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-storage z-type z-rust">let</span> other_rowcol <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>other_row<span class="z-punctuation z-separator z-rust">,</span> other_col</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-control z-rust">if</span> <span class="z-storage z-type z-rust">Self</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>in_radius<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>rowcol<span class="z-punctuation z-separator z-rust">,</span> other_rowcol<span class="z-punctuation z-separator z-rust">,</span> radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                    <span class="z-keyword z-operator z-logical z-rust">&amp;&amp;</span> <span class="z-storage z-type z-rust">Self</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>in_bounds<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-separator z-rust">,</span> other_rowcol</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                    results<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">push</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>other_rowcol</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        results
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">in_radius</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">rowcol</span><span class="z-punctuation z-separator z-rust">:</span> RowCol, <span class="z-variable z-parameter z-rust">other_rowcol</span><span class="z-punctuation z-separator z-rust">:</span> RowCol, <span class="z-variable z-parameter z-rust">radius</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-storage z-type z-rust">bool</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>row<span class="z-punctuation z-separator z-rust">,</span> col</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> rowcol<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>other_row<span class="z-punctuation z-separator z-rust">,</span> other_col</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> other_rowcol<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> row_dist <span class="z-keyword z-operator z-assignment z-rust">=</span> row<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">abs_diff</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>other_row</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> col_dist <span class="z-keyword z-operator z-assignment z-rust">=</span> col<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">abs_diff</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>other_col</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        row_dist <span class="z-keyword z-operator z-arithmetic z-rust">*</span> row_dist <span class="z-keyword z-operator z-arithmetic z-rust">+</span> col_dist <span class="z-keyword z-operator z-arithmetic z-rust">*</span> col_dist <span class="z-keyword z-operator z-comparison z-rust">&lt;</span> radius <span class="z-keyword z-operator z-arithmetic z-rust">*</span> radius
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">cell_range</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&amp;</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">center</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span>, <span class="z-variable z-parameter z-rust">radius</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-generic z-rust">RangeInclusive<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>min<span class="z-punctuation z-separator z-rust">,</span> max</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">            center<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">saturating_sub</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">            <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>center <span class="z-keyword z-operator z-arithmetic z-rust">+</span> radius</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">min</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>rows</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        min<span class="z-keyword z-operator z-range z-rust">..</span><span class="z-keyword z-operator z-assignment z-rust">=</span>max
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<h2 id="fog-of-war">Fog of war<a class="zola-anchor" href="#fog-of-war" aria-label="Anchor link for: fog-of-war">ðŸ”—</a></h2>
<p>I use a shader-based approach to build the fog of war for Siphonowar.
This is built on top of the grid system described above.
I maintain a grid where each cell stores whether a cell is unexplored, explored, or visible.</p>
<p>Whenever any entity moves, it updates the visibility grid of its previous neighbors and its new neighbors.
This state is copied to <code>visibility_texture</code>, which is accessed by a fragment shader.</p>
<p>This rendering of this grid looks like:</p>
<pre data-lang="wgsl" class="language-wgsl z-code"><code class="language-wgsl" data-lang="wgsl"><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">0</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-keyword z-control z-wgsl">uniform</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span> <span class="z-variable z-other z-wgsl">color</span>: <span class="z-storage z-type z-wgsl">vec4</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">1</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-keyword z-control z-wgsl">uniform</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span> <span class="z-variable z-other z-wgsl">size</span>: <span class="z-entity z-name z-type z-wgsl">GridSpec</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">visibility_texture</span>: <span class="z-storage z-type z-wgsl">texture_2d</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">3</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">texture_sampler</span>: <span class="z-storage z-type z-wgsl">sampler</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-keyword z-other z-fn z-wgsl">fn</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">fog_noise</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">g</span>: <span class="z-storage z-type z-wgsl">vec2</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span> <span class="z-keyword z-operator z-arrow z-skinny z-wgsl">-&gt;</span> <span class="z-storage z-type z-wgsl">f32</span> <span class="z-punctuation z-brackets z-curly z-wgsl">{</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">path2</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-storage z-type z-wgsl">vec2</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-keyword z-operator z-math z-wgsl">-</span><span class="z-constant z-numeric z-float z-wgsl">1.0</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-constant z-numeric z-float z-wgsl">0.33</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">sin_t</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">sin</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-float z-wgsl">1.4</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-variable z-other z-wgsl">globals</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>time<span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">sin_xt</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">sin</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-float z-wgsl">2.26</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-variable z-other z-wgsl">globals</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>time<span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">noise1_xy</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-storage z-type z-wgsl">vec2</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">g</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>x <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-variable z-other z-wgsl">sin_t</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">g</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>y <span class="z-keyword z-operator z-math z-wgsl">-</span> <span class="z-variable z-other z-wgsl">sin_xt</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-constant z-numeric z-float z-wgsl">0.2</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">noise1</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">perlin_noise_2d</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">noise1_xy</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">noise2_xy</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-storage z-type z-wgsl">vec2</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">g</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>x <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-constant z-numeric z-float z-wgsl">0.2</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-variable z-other z-wgsl">sin_xt</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">g</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>y <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-constant z-numeric z-float z-wgsl">0.5</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-variable z-other z-wgsl">sin_t</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-variable z-other z-wgsl">path2</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-constant z-numeric z-float z-wgsl">0.2</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">noise2</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">perlin_noise_2d</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">noise2_xy</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">noise</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">noise1</span> <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-variable z-other z-wgsl">noise2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-operator z-math z-wgsl">/</span> <span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">noise_amount</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">0.3</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-control z-wgsl">return</span> <span class="z-variable z-other z-wgsl">noise_amount</span> <span class="z-keyword z-operator z-math z-wgsl">*</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">max</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">noise</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-constant z-numeric z-float z-wgsl">0.</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-punctuation z-brackets z-curly z-wgsl">}</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">fragment</span></span>
</span><span class="z-source z-wgsl"><span class="z-keyword z-other z-fn z-wgsl">fn</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">fragment</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">mesh</span>: <span class="z-entity z-name z-type z-wgsl">VertexOutput</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span> <span class="z-keyword z-operator z-arrow z-skinny z-wgsl">-&gt;</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">location</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">0</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-storage z-type z-wgsl">vec4</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span> <span class="z-punctuation z-brackets z-curly z-wgsl">{</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">g</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">grid_coords</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">size</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">mesh</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>world_position<span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>xy<span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">output_color</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-variable z-other z-wgsl">color</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">uv</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-variable z-other z-wgsl">mesh</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>uv<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-variable z-other z-wgsl">uv</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>y <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">1.0</span> <span class="z-keyword z-operator z-math z-wgsl">-</span> <span class="z-variable z-other z-wgsl">uv</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>y<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">e</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">0.004</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">fog_amount</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">textureSample9</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">visibility_texture</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">texture_sampler</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">uv</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">e</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>r<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">alpha</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">1.0</span> <span class="z-keyword z-operator z-math z-wgsl">-</span> <span class="z-variable z-other z-wgsl">fog_amount</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-variable z-other z-wgsl">output_color</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>a <span class="z-keyword z-operator z-assignment z-wgsl">*=</span> <span class="z-variable z-other z-wgsl">alpha</span> <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">fog_noise</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">g</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-control z-wgsl">return</span> <span class="z-variable z-other z-wgsl">output_color</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-punctuation z-brackets z-curly z-wgsl">}</span>
</span></code></pre>
<h3 id="smoothing">Smoothing<a class="zola-anchor" href="#smoothing" aria-label="Anchor link for: smoothing">ðŸ”—</a></h3>
<p>To reduce flicker from entities moving back and forth on the boundary of two grid cells, I apply some manual temporal anti-aliasing by averaging the last three frames of the fog texture.</p>
<pre data-lang="wgsl" class="language-wgsl z-code"><code class="language-wgsl" data-lang="wgsl"><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">0</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-keyword z-control z-wgsl">uniform</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span> <span class="z-variable z-other z-wgsl">color</span>: <span class="z-storage z-type z-wgsl">vec4</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">1</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-keyword z-control z-wgsl">uniform</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span> <span class="z-variable z-other z-wgsl">size</span>: <span class="z-entity z-name z-type z-wgsl">GridSpec</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">visibility_texture_a</span>: <span class="z-storage z-type z-wgsl">texture_2d</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">3</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">texture_sampler_a</span>: <span class="z-storage z-type z-wgsl">sampler</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">4</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">visibility_texture_b</span>: <span class="z-storage z-type z-wgsl">texture_2d</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">5</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">texture_sampler_b</span>: <span class="z-storage z-type z-wgsl">sampler</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">6</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">visibility_texture_c</span>: <span class="z-storage z-type z-wgsl">texture_2d</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">group</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">2</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">binding</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">7</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">texture_sampler_c</span>: <span class="z-storage z-type z-wgsl">sampler</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-keyword z-other z-fn z-wgsl">fn</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">fog_noise</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">g</span>: <span class="z-storage z-type z-wgsl">vec2</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span> <span class="z-keyword z-operator z-arrow z-skinny z-wgsl">-&gt;</span> <span class="z-storage z-type z-wgsl">f32</span> <span class="z-punctuation z-brackets z-curly z-wgsl">{</span>
</span><span class="z-source z-wgsl"><span class="z-comment z-line z-double-slash z-wgsl">    // ...</span>
</span><span class="z-source z-wgsl"><span class="z-punctuation z-brackets z-curly z-wgsl">}</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">fragment</span></span>
</span><span class="z-source z-wgsl"><span class="z-keyword z-other z-fn z-wgsl">fn</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">fragment</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">mesh</span>: <span class="z-entity z-name z-type z-wgsl">VertexOutput</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span> <span class="z-keyword z-operator z-arrow z-skinny z-wgsl">-&gt;</span> <span class="z-meta z-attribute z-wgsl"><span class="z-keyword z-operator z-attribute z-at">@</span><span class="z-entity z-name z-attribute z-wgsl">location</span></span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-constant z-numeric z-decimal z-wgsl">0</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-storage z-type z-wgsl">vec4</span><span class="z-punctuation z-brackets z-angle z-wgsl">&lt;</span><span class="z-storage z-type z-wgsl">f32</span><span class="z-punctuation z-brackets z-angle z-wgsl">&gt;</span> <span class="z-punctuation z-brackets z-curly z-wgsl">{</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">g</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">grid_coords</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">size</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">mesh</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>world_position<span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>xy<span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">uv</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-variable z-other z-wgsl">mesh</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>uv<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-variable z-other z-wgsl">uv</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>y <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">1.0</span> <span class="z-keyword z-operator z-math z-wgsl">-</span> <span class="z-variable z-other z-wgsl">uv</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>y<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">e</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">0.004</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">fog_a</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">textureSample9</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">visibility_texture_a</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">texture_sampler_a</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">uv</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">e</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>r<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">fog_b</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">textureSample9</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">visibility_texture_b</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">texture_sampler_b</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">uv</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">e</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>r<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">fog_c</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">textureSample9</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">visibility_texture_c</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">texture_sampler_c</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">uv</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">e</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>r<span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">var</span></span> <span class="z-variable z-other z-wgsl">fog_amount</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">fog_a</span> <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-variable z-other z-wgsl">fog_b</span> <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-variable z-other z-wgsl">fog_c</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-operator z-math z-wgsl">/</span> <span class="z-constant z-numeric z-float z-wgsl">3.0</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-wgsl"><span class="z-storage z-type z-wgsl">let</span></span> <span class="z-variable z-other z-wgsl">alpha</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-constant z-numeric z-float z-wgsl">1.0</span> <span class="z-keyword z-operator z-math z-wgsl">-</span> <span class="z-variable z-other z-wgsl">fog_amount</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-variable z-other z-wgsl">output_color</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span>a <span class="z-keyword z-operator z-assignment z-wgsl">*=</span> <span class="z-variable z-other z-wgsl">alpha</span> <span class="z-keyword z-operator z-math z-wgsl">+</span> <span class="z-meta z-function z-call z-wgsl"><span class="z-entity z-name z-function z-wgsl">fog_noise</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">g</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-control z-wgsl">return</span> <span class="z-variable z-other z-wgsl">output_color</span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl"><span class="z-punctuation z-brackets z-curly z-wgsl">}</span>
</span></code></pre>

            
        </div>
        <div class="docs-footer print:hidden">
        </div>
    </div>
</div>

  </div>
</div>

            </div>
        </main>
        <footer class="print:hidden">
        </footer>
    </div>

    <footer class="print:hidden">
        
        <div class="footer__social-container">
            
            
            
            <a class="footer__social" href="https:&#x2F;&#x2F;github.com&#x2F;Katsutoshii" title="GitHub">
                <img src="&#x2F;assets&#x2F;profiles&#x2F;github-mark-white.svg" alt="GitHub" width="24" height="24" />
            </a>
            
            
            
            <a class="footer__social" href="https:&#x2F;&#x2F;bsky.app&#x2F;profile&#x2F;katsutoshii.bsky.social" title="BlueSky">
                <img src="&#x2F;assets&#x2F;profiles&#x2F;bluesky.svg" alt="BlueSky" width="24" height="24" />
            </a>
            
            
            
            <a class="footer__social" href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;josiah-putman-77b25a127&#x2F;" title="LinkedIn">
                <img src="&#x2F;assets&#x2F;profiles&#x2F;linkedin.svg" alt="BlueSky" width="24" height="24" />
            </a>
            
            
        </div>
    </footer>
    </div>
</body>

</html>